<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BDI Blocks World</title>
  <link rel="icon" type="image/x-icon" href="/img/logo.svg">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <!-- Mobile Header -->
  <div class="mobile-header">
    <button class="hamburger" id="mobileMenuToggle" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="mobileMenu">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </button>
    <div class="mobile-brand">
      <img src="img/logo.svg" alt="BDI Blocks World logo" class="mobile-brand-logo" />
      <span class="mobile-brand-text" id="mobileBrandText">BDI Blocks World</span>
    </div>
    <div class="mobile-header-spacer" aria-hidden="true"></div>
  </div>

  <!-- Mobile Overlay -->
  <div class="mobile-overlay" id="mobileOverlay"></div>

  <!-- Mobile Menu -->
  <div class="mobile-menu" id="mobileMenu">
    <div class="mobile-menu-header">
      <div class="mobile-menu-brand">
        <img src="img/logo.svg" alt="BDI Blocks World logo" class="mobile-menu-brand-logo" />
        <span class="mobile-menu-brand-text" id="mobileMenuBrandText">BDI Blocks World</span>
      </div>
      <button class="mobile-menu-close" id="mobileMenuClose" aria-label="Close menu">&times;</button>
    </div>

    <nav class="mobile-menu-nav" aria-label="Primary">
      <a class="mobile-menu-link" data-route="dashboard" href="index.html" aria-label="Dashboard">
        <span class="material-icons mobile-menu-icon" aria-hidden="true">dashboard</span>
        <span class="mobile-menu-label">Dashboard</span>
      </a>
      <a class="mobile-menu-link admin-nav-link is-hidden" data-route="admin" href="admin.html" aria-label="Admin Dashboard">
        <span class="material-icons mobile-menu-icon" aria-hidden="true">admin_panel_settings</span>
        <span class="mobile-menu-label">Admin Dashboard</span>
      </a>
      <a class="mobile-menu-link" data-route="agent-logs" data-disabled="true" href="#" title="Coming soon" aria-label="Agent Logs">
        <span class="material-icons mobile-menu-icon" aria-hidden="true">receipt_long</span>
        <span class="mobile-menu-label">Agent Logs</span>
      </a>
      <a class="mobile-menu-link" data-route="import-export" data-disabled="true" href="#" title="Coming soon" aria-label="Import/Export">
        <span class="material-icons mobile-menu-icon" aria-hidden="true">import_export</span>
        <span class="mobile-menu-label">Import/Export</span>
      </a>
    </nav>

    <div class="mobile-menu-help">
      <div class="mobile-menu-help-header">
        <span class="material-icons" aria-hidden="true">help_outline</span>
        <strong>Quick Help</strong>
      </div>
      <ul class="mobile-menu-help-list">
        <li>Drag blocks to move them</li>
        <li>Set goals like "on(A,B)"</li>
        <li>Run BDI to see planning in action</li>
        <li>Save or load different worlds</li>
      </ul>
    </div>
  </div>

  <div class="app">
    <aside class="sidebar" id="sidebar" data-collapsed="false">
      <div class="sidebar__inner">
        <div class="sidebar__header">
          <img src="img/logo.svg" alt="BDI Blocks World logo" class="sidebar__logo" />
          <span class="sidebar__title" id="sidebarTitle">BDI Blocks World</span>
        </div>

        <nav class="sidebar__nav" aria-label="Primary">
          <a class="sidebar__link" data-route="dashboard" href="index.html" title="Dashboard" aria-label="Dashboard">
            <span class="material-icons sidebar__icon" aria-hidden="true">dashboard</span>
            <span class="sidebar__label">Dashboard</span>
          </a>
          <a class="sidebar__link admin-nav-link is-hidden" data-route="admin" href="admin.html" title="Admin Dashboard" aria-label="Admin Dashboard">
            <span class="material-icons sidebar__icon" aria-hidden="true">admin_panel_settings</span>
            <span class="sidebar__label">Admin Dashboard</span>
          </a>
          <a class="sidebar__link" data-route="agent-logs" data-disabled="true" href="#" title="Agent logs coming soon" aria-label="Agent Logs">
            <span class="material-icons sidebar__icon" aria-hidden="true">receipt_long</span>
            <span class="sidebar__label">Agent Logs</span>
          </a>
          <a class="sidebar__link" data-route="import-export" data-disabled="true" href="#" title="Import/export coming soon" aria-label="Import/Export">
            <span class="material-icons sidebar__icon" aria-hidden="true">import_export</span>
            <span class="sidebar__label">Import/Export</span>
          </a>
        </nav>

        <div class="sidebar__help">
          <span class="material-icons sidebar__help-icon" aria-hidden="true">help_outline</span>
          <div class="sidebar__help-content">
            <strong class="sidebar__help-title">Quick Help</strong>
            <ul class="sidebar__help-list">
              <li>Drag blocks to move them</li>
              <li>Set goals like "on(A,B)"</li>
              <li>Run BDI to see planning in action</li>
              <li>Save or load different worlds</li>
            </ul>
          </div>
        </div>
      </div>

      <button class="sidebar__toggle" id="sidebarToggle" type="button" aria-label="Collapse navigation" aria-expanded="true">
        <span class="material-icons sidebar__toggle-icon" id="sidebarToggleIcon" aria-hidden="true">chevron_left</span>
        <span class="sidebar__toggle-text">Collapse</span>
      </button>
    </aside>

    <main class="main">
      <section class="hero">
        <div class="hero-header">
          <h2 class="hero-title">Simulation</h2>
          <div class="profile-dropdown">
            <button class="profile-btn" id="profileBtn" aria-label="Profile menu" aria-expanded="false">
              <span class="material-icons profile-icon">account_circle</span>
              <span class="profile-name" id="profileName">Guest</span>
              <span class="material-icons profile-arrow">expand_more</span>
            </button>
            <div class="profile-menu" id="profileMenu">
              <!-- Logged in state -->
              <div id="profileMenuLoggedIn" style="display:none;">
                <a href="#" class="profile-menu-item" id="viewProfile">
                  <span class="material-icons">person</span>
                  <span>Profile</span>
                </a>
                <a href="admin.html" class="profile-menu-item" id="adminMenuItem" style="display:none;">
                  <span class="material-icons">admin_panel_settings</span>
                  <span>Admin Dashboard</span>
                </a>
                <a href="#" class="profile-menu-item" onclick="logout(); return false;">
                  <span class="material-icons">logout</span>
                  <span>Logout</span>
                </a>
              </div>
              <!-- Logged out state -->
              <div id="profileMenuLoggedOut">
                <a href="login.html" class="profile-menu-item">
                  <span class="material-icons">login</span>
                  <span>Sign In</span>
                </a>
                <a href="signup.html" class="profile-menu-item">
                  <span class="material-icons">person_add</span>
                  <span>Register</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div class="grid">
        <section class="card">
          <h3>Simulation Environment</h3>
          <div class="simwrap">
            <div id="world-wrapper" class="card-body world-wrapper-no-padding">
              <div id="world"></div>
            </div>
            <div id="messages" class="messages"></div>
          </div>
        </section>

        <section class="card">
          <h3>Control Panel</h3>
          <div class="card-body">
            <div class="controls-grid">
              <div class="control-card control-card--blocks">
                <div class="control-card__header">
                  <span class="control-card__title">Blocks</span>
                  <span class="control-card__meta">Next: <span id="nextBlockLabel">A</span></span>
                </div>
                <div class="block-stepper">
                  <button id="removeBlockBtn" type="button" class="control-round-btn" aria-label="Remove last block">âˆ’</button>
                  <span class="block-stepper__count"><span id="blockCountLabel">0</span> active</span>
                  <button id="addBlockBtn" type="button" class="control-round-btn" aria-label="Add next block">+</button>
                </div>
              </div>

              <div class="control-card control-card--goal">
                <label for="goalInput" class="control-card__title">Goal stack</label>
                <div class="goal-row">
                  <input type="text" id="goalInput" placeholder="e.g. A on C on D" />
                  <button id="startBtn" type="button">Start Simulation</button>
                </div>
              </div>

              <div class="control-card control-card--actions">
                <div class="control-card__header">
                  <span class="control-card__title">Saved worlds</span>
                  <span class="control-card__meta">Manage configurations</span>
                </div>
                <div class="control-actions">
                  <button id="saveBtn" type="button">Save Current</button>
                  <select id="loadSelect" title="Saved worlds"></select>
                  <button id="loadBtn" type="button">Load Selected</button>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>

      <div class="row-below">
        <section class="card">
          <h3>Information Panel</h3>
          <div class="card-body">
            <div class="info-grid">
              <div class="info-tile">
                <div class="info-label">Goal State</div>
                <div id="info-goal" class="info-content">â€”</div>
              </div>
              <div class="info-tile">
                <div class="info-label">Current Configuration</div>
                <div id="info-current" class="info-content">â€”</div>
              </div>
              <div class="info-tile">
                <div class="info-label">Stats</div>
                <div id="info-stats" class="info-content">
                  <div class="stat-line"><strong>Total Steps:</strong> <span id="stat-steps">--</span></div>
                  <div class="stat-line"><strong>Time Elapsed:</strong> <span id="stat-time">--</span></div>
                  <div class="stat-line"><strong>Status:</strong> <span id="stat-status">--</span></div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="card">
          <h3>Action Tower</h3>
          <div class="card-body">
            <div id="actionLog" class="log"></div>
          </div>
        </section>

        <section class="card">
          <h3>Intention Timeline</h3>
          <div class="card-body">
            <div class="timeline-clock">
              <span class="timeline-clock-label">Elapsed</span>
              <span id="plannerClock" class="clock-display">--:--</span>
            </div>
            <div id="intentionTimeline" class="timeline"></div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script src="config.js"></script>
  <script type="module">
    // Authentication guard
    import { requireAuth, logout as authLogout, updateUIWithUserInfo } from './utils/auth.js';
    requireAuth();
    
    // Expose logout globally for onclick handlers
    window.logout = authLogout;
    
    window.addEventListener('load', () => {
      updateUIWithUserInfo({
        adminNav: '.admin-nav-link'
      });
    });
  </script>
  <script type="module" src="utils/main.js"></script>
  
</body>
</html>
